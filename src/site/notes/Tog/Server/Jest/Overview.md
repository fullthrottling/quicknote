---
{"share_link":"https://share.note.sx/ak4oc6fq#quKKIyerPqBDb336E35+6sQ1u31KLIOxEBJwi0Wyp4w","share_updated":"2024-09-27T20:08:48+09:00","dg-publish":true,"permalink":"/Tog/Server/Jest/Overview/","dgPassFrontmatter":true}
---



<h5><span>목차</span></h5><p><span><ol>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 하려는 작업 목록들" data-href="Tog/Server/Jest/Overview.md#하려는 작업 목록들" href="Tog/Server/Jest/Overview.md#하려는 작업 목록들" class="internal-link" target="_blank" rel="noopener">하려는 작업 목록들</a>
<ol>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 진행상황" data-href="Tog/Server/Jest/Overview.md#진행상황" href="Tog/Server/Jest/Overview.md#진행상황" class="internal-link" target="_blank" rel="noopener">진행상황</a></li>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 이후 아이디어" data-href="Tog/Server/Jest/Overview.md#이후 아이디어" href="Tog/Server/Jest/Overview.md#이후 아이디어" class="internal-link" target="_blank" rel="noopener">이후 아이디어</a></li>
</ol>
</li>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 테스트 개편 현황" data-href="Tog/Server/Jest/Overview.md#테스트 개편 현황" href="Tog/Server/Jest/Overview.md#테스트 개편 현황" class="internal-link" target="_blank" rel="noopener">테스트 개편 현황</a></li>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 테스트 시스템 개편(for Jest)" data-href="Tog/Server/Jest/Overview.md#테스트 시스템 개편(for Jest)" href="Tog/Server/Jest/Overview.md#테스트 시스템 개편(for Jest)" class="internal-link" target="_blank" rel="noopener">테스트 시스템 개편(for Jest)</a>
<ol>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 이벤트 일정에 따른 스케쥴 구현" data-href="Tog/Server/Jest/Overview.md#이벤트 일정에 따른 스케쥴 구현" href="Tog/Server/Jest/Overview.md#이벤트 일정에 따른 스케쥴 구현" class="internal-link" target="_blank" rel="noopener">이벤트 일정에 따른 스케쥴 구현</a>
<ol>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 시간 변경 단위 테스트" data-href="Tog/Server/Jest/Overview.md#시간 변경 단위 테스트" href="Tog/Server/Jest/Overview.md#시간 변경 단위 테스트" class="internal-link" target="_blank" rel="noopener">시간 변경 단위 테스트</a></li>
</ol>
</li>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 에러 패킷 예측" data-href="Tog/Server/Jest/Overview.md#에러 패킷 예측" href="Tog/Server/Jest/Overview.md#에러 패킷 예측" class="internal-link" target="_blank" rel="noopener">에러 패킷 예측</a></li>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 선행 작업이 필요한 테스트" data-href="Tog/Server/Jest/Overview.md#선행 작업이 필요한 테스트" href="Tog/Server/Jest/Overview.md#선행 작업이 필요한 테스트" class="internal-link" target="_blank" rel="noopener">선행 작업이 필요한 테스트</a>
<ol>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 시즌 서버 모킹" data-href="Tog/Server/Jest/Overview.md#시즌 서버 모킹" href="Tog/Server/Jest/Overview.md#시즌 서버 모킹" class="internal-link" target="_blank" rel="noopener">시즌 서버 모킹</a></li>
</ol>
</li>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 모킹(Mocking)" data-href="Tog/Server/Jest/Overview.md#모킹(Mocking)" href="Tog/Server/Jest/Overview.md#모킹(Mocking)" class="internal-link" target="_blank" rel="noopener">모킹(Mocking)</a>
<ol>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 이벤트 테이블 모킹" data-href="Tog/Server/Jest/Overview.md#이벤트 테이블 모킹" href="Tog/Server/Jest/Overview.md#이벤트 테이블 모킹" class="internal-link" target="_blank" rel="noopener">이벤트 테이블 모킹</a></li>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 로직 모킹" data-href="Tog/Server/Jest/Overview.md#로직 모킹" href="Tog/Server/Jest/Overview.md#로직 모킹" class="internal-link" target="_blank" rel="noopener">로직 모킹</a></li>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 기타 모킹" data-href="Tog/Server/Jest/Overview.md#기타 모킹" href="Tog/Server/Jest/Overview.md#기타 모킹" class="internal-link" target="_blank" rel="noopener">기타 모킹</a></li>
</ol>
</li>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 그룹 단위 테스트" data-href="Tog/Server/Jest/Overview.md#그룹 단위 테스트" href="Tog/Server/Jest/Overview.md#그룹 단위 테스트" class="internal-link" target="_blank" rel="noopener">그룹 단위 테스트</a>
<ol>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 필요한 테스트만 빠르게" data-href="Tog/Server/Jest/Overview.md#필요한 테스트만 빠르게" href="Tog/Server/Jest/Overview.md#필요한 테스트만 빠르게" class="internal-link" target="_blank" rel="noopener">필요한 테스트만 빠르게</a></li>
</ol>
</li>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 테스트 시각화" data-href="Tog/Server/Jest/Overview.md#테스트 시각화" href="Tog/Server/Jest/Overview.md#테스트 시각화" class="internal-link" target="_blank" rel="noopener">테스트 시각화</a>
<ol>
<li dir="auto"><a data-tooltip-position="top" aria-label="Tog/Server/Jest/Overview.md > 결과 리포트" data-href="Tog/Server/Jest/Overview.md#결과 리포트" href="Tog/Server/Jest/Overview.md#결과 리포트" class="internal-link" target="_blank" rel="noopener">결과 리포트</a></li>
</ol>
</li>
</ol>
</li>
</ol></span></p>
# 하려는 작업 목록들
## 진행상황

| 작업 대분류 | 세부분류                | 진행도 | 코멘트                        |
| ------ | ------------------- | --- | -------------------------- |
| 앱스미스   | 앱스미스를 통한 서버 기본정보 접근 | 100 |                            |
| -      | 서버에 적용중인 JSON Viewr | 100 |                            |
| -      | PostMan 치트 이전       | 10  | 기존 골자는 만들어졌으나 세부 목록들 이전 예정 |
| 테스트개편  | 아래 내용들..            | 50  |                            |
| 서버헬퍼   | 각 샤딩 디비에 일괄 쿼리      | 100 |                            |
| -      | 엑셀 Export           | 100 | 선택된 결과 excel로 추출           |
## 이후 아이디어
- 앱스미스 쪽에 캐릭터 Copy 기능 추가 
- 서버 헬퍼쪽에 Redis Select Export 추가
- 서버 헬퍼쪽에 S3연동을 통한 파일 자동 업로드 추가
- 서버 헬퍼쪽에 Daily ErrorCode Summary(ctog) 기능 추가

# 테스트 개편 현황

| 작업         | 진행도 |
| ---------- | --- |
| 가상타이머 적용   | 100 |
| 시즌타이머모킹    | 90  |
| 테스트 그룹 분리화 | 90  |
| 로그 개편      | 50  |
| 시각화        | 20  |
| 코드 리팩토링    | 0   |

# 테스트 시스템 개편(for Jest)
## 이벤트 일정에 따른 스케쥴 구현
### 시간 변경 단위 테스트
>[!success] 가상 타이머
> [Jest FakeTimer Document](https://jestjs.io/docs/timer-mocks)
> 시간 홀드
> 시간 변경
> 강제 틱전환등의 기능 이용가능
> 이벤트 시간 변환등으로 다양한 상황 실현 예측

## 에러 패킷 예측
>[!summary] 기존 테스트
>패킷 에러시 assert 발생등으로 정규화 테스트 코드에 실패 케이스 테스트 추가 불가능하여 정규화 테스트시 실패 케이스 테스트 돌아가지 않음

>[!success] After
>[Jest Expect Document](https://jestjs.io/docs/expect)
>패킷의 예상 결과 값 적용
>함수, 결과값의 벨류 검증등 활용

```ts title:실패케이스
//Bad Param Test
leaguer.updateSampleBattleLineup(battleType, deathMatchLineupStageType, Constants.MAX_DEATH_MATCH_LEAGUE_ROUND - 1);

await leaguer.deathMatchLeagueSetDeckRequest(ErrorCode.BAD_REQUEST, battleType, deathMatchLineupStageType);  
```

```ts title:성공케이스
leaguer.updateSampleBattleLineup(battleType, deathMatchLineupStageType, Constants.MAX_DEATH_MATCH_LEAGUE_ROUND);

await leaguer.deathMatchLeagueSetDeckRequest(ErrorCode.OK, battleType, deathMatchLineupStageType);
```

## 선행 작업이 필요한 테스트
### 시즌 서버 모킹
>[!summary] 목적
>하이랭커 아레나, 진검승부리그 ...
>특정 타이머기반의 정산이 필요한 경우 테스트가 복잡하고 강제로 DB값만 변경하다보면 타이머 로직 에러를 찾기 힘들다

>[!important] 어떻게?
>각 타이머의 오브젝트를 불러온 후 대기 큐 처리
>시간 변경-> 타이머 로직 대기->로직완료후 코드 기반

## 모킹(Mocking)
>[!summary] 목적
>기존 코드를 건들이지 않는 수준으로 실행하는 Object Mocking
>[Jest Document](https://jestjs.io/docs/mock-functions)
>[유저 안내](https://www.designkits.co.kr/blog/web-terminology/Mocking)
### 이벤트 테이블 모킹
- 테스트를 위한 Json 임시 세팅 편리.
### 로직 모킹
- Logger Class, Console.Log등의 모킹을 활용한 커스텀한 로그 작성 가능
### 기타 모킹
- API서버 통신등 기타 외부 모듈등의 결과 값 강제화로 테스트 시간 단축 가능

## 그룹 단위 테스트
### 필요한 테스트만 빠르게
>[!summary] 기존 테스트로직
>전체 목록에서 필요한거만 Enable 처리후 테스트
>선행 되어야하는 로그인등의 처리 때문에 별도로 분리가 불편
>전체 테스트는 결국 안되는 상황

>[!success] 어떤식으로?
>주기적인 전체 테스트
>실패한 케이스만 다시 돌아가는 옵션(Jest Watched) 으로 실패 부분만 다시 확인
>필요에 따라 필요한 그룹(컨텐츠) 혹은 테스트(컨텐츠안의 테스트 케이스)로 분리하여 작업간에 선택하여 빠른 테스트

## 테스트 시각화
### 결과 리포트
> [!todo] 결과 리포트 구성
> 돌아가는 동안 발생한 expect항목들의 목록
> 백단의 게임서버/시즌 서버의 별도 로그 모음 등..





